# Swift_PR

## 공모전
https://www.busan.go.kr/depart/abnotice/1676994

## 야무진 사이트
1. 아이콘
- https://www.flaticon.com/

### 5/8 
- swift 기초문법숙지 (react랑 구성이 비슷해보이네 다 component 지향 설계를 하면 될듯
- xcode 둘러보기
- inspector랑 Main 보드를 적극 활용하면 좋을듯 ( 이건 unity랑 비슷한 부분이 있네)
- 문법 자체는 js랑 파이썬과 유사한 느낌이다.
- 프로그램 자체의 버퍼가 좀 끼는편이고 랜더링이 좀 늦네.. 이건 내 맥 사양문젠것 같고
- 간단한 계산기 구현해보면서 연습해봄

### 5/9

- Mysql, Spring이랑 Swift를 이용해서 로그인 구현
- MVC 설계 / 테스트코드 구현
- 간단한 UI구현
- 성공적!

### 5/10

- Constraint 이것저것 맛좀보기
- View - Controller 연결 이것저것
- Inspector 공부
- 로또앱 날씨앱 만들어보기 기본 로직으로만
- 옵셔널 선언 문법
   + ?	옵셔널, 값이 있을 수도 없을 수도 있음	안전
   + !	강제 언래핑, 무조건 있다고 믿음	위험 (nil이면 앱 죽음)
 

### 5/11

- UI upcasting
- Delegrate Pattern
- swift 상속
- extension

### 5/12
- 로그인관련 테스트케이스, 코드 작성
- API 쭉 보고 테스트해봤는데 성공적, 내일좀 신경써보자
- Constraint 는 계속 해도 헷갈리네... xcode오류인지...아니면 대체 뭐가문젠거야!!!
- ngrok쓸때마다 http초기화되는데 지금은 deg에 넣어놨찌만 좀더 편한 방법이 있을것 같다.


### 5/13
- 카카오 지도 API 불러오기
- SDK , pod 이거 와 진짜 너무 불친절해서..(사실내탓이긴한데) 진짜 별에별거 다하다가
-  한 ... 반나절만에 진짜 ㅠㅠㅠ 겨우 지도 띄우기 성공
-  IOS 너무 힘들어...... 흐아ㅜㄹ우ㅏ후우우ㅜㅠㅠㅠ
  
### 5/14
- 해야할일
   + 현재 위치 불러오기
   + 지도에 마커 다찍기
 
### 5/15
- kakao API + 버스 API
- null 값 일단 '이름없음'으로 처리해서 익셉션 처리
- 중복문제가 좀 고민인데, 중복처리 하자니 누락이 생기는 것 같고, 안하자니 같은 좌표에 두개가 찍힘
- 이거 해결하려고 좌표값 x,y  반올림해서 .5로 묶고 변수로 만들어서 중복 포인트 넣어봤는데 이러면 또 누락이 생기기도하고(원인 파악중), 이게 name이나 다른 벨류 값 가져올때 또 에러 터질것 같단 말이지..
- 마커 줌인,아웃 생고생하다가 가이드라인 정독으로 해결

### 5/16
- 엄청난 성과..? 를 얻었다
- 객체에 다저장하려는거 그냥 구조체 하나 만들어서 UI랑 데이터를 분리시켰음
- 처음에는 오히려 랜더링이 느려질줄 알았는데..ㅋㅋㅋㅋ 그냥 말도안되게 성능 올라왔고, 데이터에 더 안전하게 접근함 ㅎㅎ

- 오늘한거
  + Object > Dict 형식으로 호출 및 캐스팅 리펙터링
  + TableView 에 Cell추가해서 정류장ID기반으로 도착 버스 불러오기
  + 새로고침 버튼 추가로 실시간성 확보

- 남은거
   + 새로고침하면 백엔드로 어떤 데이터 전송하면 될지 고민하기
   + 테이블구조 리펙터링
   + 와치 백엔드랑 통신할지 프론트랑 통신할지도 고민하고
   + 와치 통신하면 이제 햅틱효과까지 해서 잘되면 프로토타입 마무리!
   + 서버하나 사서 전환하고, UI 개선 진행하면 끝!
   + ERD, 깃, 노션 전부 한번 싹정리까지!

### 5/17
- 즐겨찾기용 DB만들기
- 세션으로 페이지 할당하려다가 미래지향적 사고로 JwtToken으로 할당했다.. 메서드 개빡이다 진짜 ㅋㅋ
- 그리고 JPA의 엄청난 개짓거리후 진짜... 얘는 클래스 이름으로 DB가 비면 자기가 그냥 새로 테이블을 만듬.. 아니 s붙여도 인식해준다며 ㅠㅠㅠㅠㅠㅠㅠㅠㅠㅠㅠㅠㅠㅠㅠㅠㅠ
- 진짜 개고생해서 그냥 강제 @Table(name = "favorites") 어노테이션......매칭했더니 3시간동안 진짜 별에별짓을 다하다가 결국에 해냈다..
- 으아!!!!!!!!!!!!!!!!!!!!
- swift에서 즐겨찾기만 해놓고 해제기능하려고 하다가 처음으로 버튼대신 이미지를 달아봤는데.. 애초에 사진을 512px짜리를 강제로 줄이려니까 미친듯한 코드와.. constraint 오류는 왤캐 많이뜨는거냐 ㅠㅠㅠㅠ
- 결국... 그냥 24px로 이미지 수정해서 에셋에 넣으니가...참 잘되네 ..^^ㅋㅋㅋ;ㅋ;ㅋ;ㅋ;ㅋ;ㅋ;ㅋ;ㅋ ㅠㅠㅠㅠㅠㅠㅠㅠㅠㅠㅠㅠ
- 오늘...생각보다 많은걸 한것 같지만..그래 했으면 된거야 ^^7

- 오늘한거 정리
  + foreign 즐찾 디비 만들고
  + 토큰발급하고
  + 백엔드 테스트코드 끄적이고
  + 프론트 ui 개선하고..
  + insert, delete 아주잘되는거 확인했고
  + 잦은버그...한게 너무많아서 로그를 써야하는것도 힘들다.. 암튼 많은걸 했다  ..^^&&*!!!

- 남은거
   + 진짜 배포한다고 생각하니까 너무 아득하다
   + 이제 와치랑 ios, 백을 연결해야하는데.. 이거 설계좀 이쁘게하고
   + 와치 ui는 좀 신경쓸 예정이다.
   + 근데 이거 배포가 목적이면...와 나 너무 까마득한데?
   + 일단 지금 생각나는 오류부터 끄적여보자..
   + 1. 시내버스 갱신하면 마을버스가 갱신됨 ㅋㅋㅋㅋㅋㅋ 이거 API 딱봐도 Name으로만 불러와서 그런거같은데 ㅠㅠㅠㅠㅠㅠㅠㅠㅠㅠ딕셔너리 다시짜야돼
     2. 지도 띄울때 이거 디비도 불러와서 확인해야할거같다 하... 토큰으로 비교하면 될것같고 토큰값에 id 있는건 다 미리 노란별 띄우면 될듯
     3. 그리고 마커도 초록 파랑으로 마을, 시내 구분해야할거같다. 근데 버스 뭐..희한한것도 많지않나? 프로토타입이니까 적당히 ^^
     4. 디비 ... 이거 기본키 대충한거 너무 뼈아픈데 어떡하지.. 이거 진지하게 디비 다시짜야하는 불상사가... 아니 그럼백엔드...아니 그럼 나 ..죽어
     5. 그냥.. 몇명이나쓰겠어..10만명 커버가능하잖아(김칫국)
     6. 로그인도 오지게 대충만들어서 ㅋㅋㅋㅋㅋㅋ 근데 진짜 꿈만 큰건가.. 안해도되는건데 왜 자꾸 많은 유저가 쓸꺼라고 생각하는거야 ^!^!^!^
     7. xcode로 디자인도 다...................해야하는데..........................재밌겠지 ㅋ..........ㅋ ............. 그립읍니다 css
     8. 깃허브에 백업파일 안올리는 오만방자 천둥벌거숭이같은 짓은 그만하고 지금이라도 자주 머지해  제발 정신차려


### 5/18
- 존 Xcode 워치 설정 꼬여서 전체 프로젝트 리셋 결정
- OS + Watch 타겟 새로 셋업 (Storyboard + SwiftUI 혼용)
- App Group 설정 확인 (group.jihoon)
- Watch App과 iOS App 간 데이터 공유 확인 시도 (UserDefaults)
  + 요약 : 진짜 워치 정보 너무 없어서 그냥 포기하고싶었는데 하....진짜 환경세팅이 제일 개빡이다 결국성공.. 페어링 하는거만 진짜 ㅋㅋㅋ

- 해결 방향 바꿈: WatchConnectivity로 전환
- iOS에서 sendMessage와 updateApplicationContext로 전송
- Watch에서 didReceiveMessage, didReceiveApplicationContext 처리

- 백엔드 수정. bus_id만 넘겨주고 bud_name은 안넘겨주는거 디비 새로 Insert하고 백엔드 로직 추가
- json 디코딩도 진짜 왜안되나 싶었는데 무한루프 돌고있었음...하..
-  @com.fasterxml.jackson.annotation.JsonIgnore 고맙다 스프링아..

- 결론 : 일단 워치 연동 성공했고 즐겨찾기 리스트까지 불러오는거 성공했다. 지금 정체성, 아니 앞으로 1인개발자는 절대 절대 절대 생각도 안날것 같다^^
- 내가 지금 기획.. <하 이거 진짜 설계의 중요성을 다시한번 느낀다. 일단 막무가내로 시작하는것좀 하 ㅡㅡ 버려 이자식아
- 백엔드 짜는것도 지금 디비랑 로직이 적어서 그렇지... 프론트 디비 다건드는게 쉽지않다
- 프론트 : 와치 + ios : 이 악랄한 자식들, 구글링 없이 gpt와 맨땅에 해딩하는게 진짜 고역이다. 와 이거 진짜 프론트엔드 만만하게 보는애들 그냥 줄빠따
- 서버.. 그냥 얘가 제일 힘듬. 그냥 네트워크가 제일 힘들어 하 형님... 서버개발자 ..당신은 GOAT

   + 남은거 : 이제 워치 arrivatInfo.swift만 작성하면 거의 프로토타입은 완성이다..!!
   + 약 10일동안 하루에 최소 6시간에서 최대 12시간씩은 코딩한거같은데, 단기간에 꽤많이 고생한거같다.. 성과도 았었고, 이거 시간끌면 코드 이거뭐지..이렇게 될 확률 100퍼
   + 계속 코드보고 테스트코드 작성하면서 갖가지 디버깅도 해야할거같다.
   + 디자인도 신경쓰자.. xcode로 디자인 건드는거 너무겁난다.
       + 결론 : 마지막 페이지 하나 남았다!!!!!, 디자인은 뭐 ㅋ
    
### 5/19
- ArrivalInfo.siwft에서 공공데이터 키로 API통신구현
- 하... 백엔드에서 인코딩하고 불러쓰려니까 이중 인코딩해서 디코딩으로 푼걸 백엔드에 써넣고 인코딩 시켰는데 키 불일치 오류된다
- 네트워크 통신에서 인코딩할때 뭐가 깨지는것 같은데 문제를 잘모르겠음
- 그래서 swift에서 직접 통신하는데, https 보안문제 예외처리 하려구 inof.plist를 작성하는데 와...진짜 xcode 너무 불친절하다. 고통스럽게 예외처리하면서 다설정함.
- 결국 예외처리 성공
- 이제 전체적인 회로는 완벽하게 구현된 상황이다.
- 코드리뷰하면서 코드 정리좀하고, 해싱 ,ui 좀 다듬자

### 5/19
- 워치 로직추가
- 남은시간마다 햅틱 및 1분미만일때 곧도착효과!
- 리스트에서 그냥 View로 바꿈. 갱신 버튼은 있는게 좋을듯
- UI구현을 하면 좋은데 흠.. 일단 코드리뷰계속하면서 정리좀하자


### 5/20 오늘한거
- 비밀번호 해싱 추가 jpa
- 회원가입 제약 추가(문자열길이, 중복체크, 이메일)
- 로그인 제약 추가
- UI 개선 및 디자인 추가, 로고이미지 생성


### 5/21 
- 박종규 교수님 피드백
- 데이터베이스에 다음정류장 추가..(알고리즘 진짜 개빡이다) 겨우성공했다 하..
- 트랜젝션 그나마 제일 최소화했고 이거 계속 코드리뷰 해야겠다..
- 이제 정말 거의 다왔다
  + 남은거
  + 로그아웃, 회원탈퇴 기능
  + 화면마다 뒤로가기 달아야하고
  + 워치 리스트에서도 남은시간 확인할수있게하고
  + 토큰이 캐시에 아주잘 저장되어있는지, 확인해야되고
  + 이거 지도 페이지에 이미 즐찾되있는거 노란색으로 렌더링되게

### 5/22
- 즐겨찾기 별 안바뀌는거 수정해야하고
- 한번랜더링할때 디비에서 이미 등록된건 별표처리 해야됨
- 현위치 버튼 이미지로 바꾸고
- 뒤로가기 버튼 추가해야되고



### 5/24
- 버스다음정류장 예측 알고리즘 최선의 개선..
- 진짜 험난한 여정이였다..
- 대체 그 수많은 버스정류장과 버스번호의 조합으로 엄청난 트래픽을 감내하면서 다음정류장 예측을 어떻게 하지
- 정답은 너무나도 단순했다
- 라이아이디에 도착하는 버스정보를 리스트에 담은후에 소팅하여 카운트했다.
- 진짜 성공적.. 다른 앱이랑 비교해도 손색없는 성능
- 심지어 퀄리티도 잘나온다.
- 이로써 개인 API 트래픽량을 급격하게 감소시켰으며, 서버 부하도 줄였다.
- 검색엔진 너무잘되용 ㅋㅋ
- 이제 진짜 거의다왔다.. 포기하고싶었는데 안하길잘했다

### 5/23 
- 검색기능을 위해 디비 인서트문 분리 예정
- API 트래픽 호출을 줄여야하는데 스프링말고 순수자바로 진행고민
- 서버 부하 고민


### 5/24
- 순수자바로 jdbc활용해서 API로 정류장 예측 알고리즘 성공!
- intellij 디비 기능 500건만 뜨는것땜에 뻘짓 오지게했네
- 백엔드에서 먼저 받고 데이터 호출을통해 서버 안정화
- 변수명좀 신경쓰자.. 통싱할때 디코딩 인코딩 진짜 미치겟는데 이거 공부좀 해야할거같다
- 아무은 어재저째 완벽한 ? 검색기능 완성 
- 정말 마무리단계다.
- 로그아웃, 회원탈퇴 기능 넣고 토큰인증 메인화면 이동,
- 워치 알고리즘 검증좀 계속하고 디자인만 야무지게 손보면 끝이다
- 파이팅



### 5/25
- 다왔따...진짜 거의다왔ㄷ어
- 모든준비는 끝났다...테스트 플라이트 잘올라갔고
- 빌드 백엔드 모든 통신 잘되고
- 애플워치 통신 잘되고
- 토큰 관리 잘되고
- 보안 잘되고
- ui만 손보자.. 진짜 다왔다


### 5/26

- 맵핀찍는거 진짜 내가슴의 응어리... 드디어 해결했다.
- unfromat image error을 누가 지도 랜더링 경고로 알겠냐...당연히 마커이미지인줄알지..
- 한번에 8000개이상을 랜더링하는데 당연히 부하가 올수밖에
- 거리 측정 알고리즘으로 해결해보자
- 캐시에 먼저 다 저장해놓은다음에 랜더링할때는 내위치기반으로 캐시에서 꺼내쓰자
- API호출하면 한번 페이지 들어갈때마다 0.6메가 정도 트래픽이 발생할거같은데 비용이 너무 크니까 캐시에 한번 렌더링 후 캐시에서 백엔드 통신을 하자 이게 최선일거같다.


## IOS CLEAR


### 5/26

watch OS 남은거
- favoritelist에서도 남은시간 확인할수 있게하고, 도착 시간 순으로 소팅하기
- 즐겨찾기 버튼도 너무구러
  
- 도착시간 페이지 햅티깅랑 화면 효과 UI 수정하고, 소리도 나게 한번해보자



### 5/28
- 종점을 찍는날이 온건가.. 아니 아직 1차 종점..? ?? 말이 이상하긴한데
- 아무튼 드디어 나혼자 테스트 열심히하고 앱심사를 맡겼다..
- 1.0.2 버전 (앞에 두버전은 실험용 ㅎㅎ)
- 이것저것 정책설정하고.. 보안 신경쓴다고 https, 프록시에 트래픽 제어 통신 이것저것..
- 개발하면서 정말 많이 배웠던것 같다.
- 비록 GPT의 큰도움덕분에 IOS개발을 완성할수(아직 승인은 안났지만) 있었지만..
- 나름 의미있는 시간이였던것 같다.
- 리젝되면 굉장히 슬플거같지만 승인날때까지 도전해야지
- 첫술에 배부를순 없지만 앞으로도 꾸준히 업데이트해보자
- 일단 기도하고 있자 ㅋㅋ

### 5/29
- 앱심사대기 진행중


### 5/30
- 심사 리젝
사유 : Guideline 5.1.1 - Legal - Privacy - Data Collection and Storage
Issue Description
The app requires users to register or log in to access features that are not account based.
Specifically, the app requires users to register before accessing the app. Apps may not require users to enter personal information to function, except when directly relevant to the core functionality of the app or required by law

- 앱에서 로그인, 회원가입을 하지 않으면 기능을 이용하지못한다는 이유로 리젝..
- 아니 회원정보를 필수로 하는 앱인데 하.. 새벽부터 루트화면에 프리뷰 기능을 추가했다..
- 이러다 내가 생각못한 다양한 사유도 나올것 같은데 흑흑


### 6/1
- 리젝수정
- 루트 페이지를 BusMainView로 변경
- 비 로그인시 로그인필수 오브젝트 비활성화
- 즐겨찾기 삭제시 리스트 익덱스 번호가 중독되서, UI에 업데이트 안되는 버그 발견( 삭제 후  남은 인덱스 업뎃)
- 라우팅 경로 수정 및 토큰 확인 최소화로 트래픽 유발 감소
- 
